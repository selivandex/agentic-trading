# @format

# Strategy types and operations

enum StrategyStatus {
  ACTIVE
  PAUSED
  CLOSED
}

enum MarketType {
  SPOT
  FUTURES
}

enum RiskTolerance {
  CONSERVATIVE
  MODERATE
  AGGRESSIVE
}

enum RebalanceFrequency {
  DAILY
  WEEKLY
  MONTHLY
  NEVER
}

type Strategy {
  id: UUID!
  userID: UUID!
  user: User

  # Strategy metadata
  name: String!
  description: String!
  status: StrategyStatus!

  # Capital allocation
  allocatedCapital: Decimal!
  currentEquity: Decimal!
  cashReserve: Decimal!

  # Configuration
  marketType: MarketType!
  riskTolerance: RiskTolerance!
  rebalanceFrequency: RebalanceFrequency!
  targetAllocations: JSONObject

  # Performance metrics
  totalPnL: Decimal!
  totalPnLPercent: Decimal!
  sharpeRatio: Decimal
  maxDrawdown: Decimal
  winRate: Decimal

  # Timestamps
  createdAt: Time!
  updatedAt: Time!
  closedAt: Time
  lastRebalancedAt: Time

  # Reasoning log
  reasoningLog: JSONObject
}

"""
Edge type for Strategy
"""
type StrategyEdge {
  """
  The item at the end of the edge
  """
  node: Strategy!

  """
  A cursor for use in pagination
  """
  cursor: String!
}

"""
Connection type for Strategy collection
"""
type StrategyConnection {
  """
  A list of edges
  """
  edges: [StrategyEdge!]!

  """
  Information to aid in pagination
  """
  pageInfo: PageInfo!

  """
  Total count of items (if available)
  """
  totalCount: Int!
}

input CreateStrategyInput {
  name: String!
  description: String!
  allocatedCapital: Decimal!
  marketType: MarketType!
  riskTolerance: RiskTolerance!
  rebalanceFrequency: RebalanceFrequency!
  targetAllocations: JSONObject
}

input UpdateStrategyInput {
  name: String
  description: String
  riskTolerance: RiskTolerance
  rebalanceFrequency: RebalanceFrequency
  targetAllocations: JSONObject
}

# Queries
extend type Query {
  # Get strategy by ID
  strategy(id: UUID!): Strategy

  # Get strategies for a specific user
  userStrategies(
    userID: UUID!
    status: StrategyStatus
    first: Int
    after: String
    last: Int
    before: String
  ): StrategyConnection!

  # Get strategies for current user
  strategies(
    status: StrategyStatus
    first: Int
    after: String
    last: Int
    before: String
  ): StrategyConnection!
}

# Mutations
extend type Mutation {
  # Create new strategy
  createStrategy(userID: UUID!, input: CreateStrategyInput!): Strategy!

  # Update strategy
  updateStrategy(id: UUID!, input: UpdateStrategyInput!): Strategy!

  # Pause strategy
  pauseStrategy(id: UUID!): Strategy!

  # Resume strategy
  resumeStrategy(id: UUID!): Strategy!

  # Close strategy
  closeStrategy(id: UUID!): Strategy!

  # Delete strategy (hard delete, only for closed strategies)
  deleteStrategy(id: UUID!): Boolean!

  # Batch delete strategies (hard delete, only for closed strategies)
  batchDeleteStrategies(ids: [UUID!]!): Int!
}
