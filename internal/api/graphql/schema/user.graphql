# @format

# User types and operations

type User {
  id: UUID!
  telegramID: String
  telegramUsername: String
  email: String
  firstName: String!
  lastName: String!
  languageCode: String!
  isActive: Boolean!
  isPremium: Boolean!
  limitProfileID: UUID
  settings: Settings!
  createdAt: Time!
  updatedAt: Time!
}

"""
Edge type for User
"""
type UserEdge {
  """
  The item at the end of the edge
  """
  node: User!

  """
  A cursor for use in pagination
  """
  cursor: String!
}

"""
Connection type for User collection
"""
type UserConnection {
  """
  A list of edges
  """
  edges: [UserEdge!]!

  """
  Information to aid in pagination
  """
  pageInfo: PageInfo!

  """
  Total count of items (if available)
  """
  totalCount: Int!
}

type Settings {
  defaultAIProvider: String!
  defaultAIModel: String!
  riskLevel: String!
  maxPositions: Int!
  maxPortfolioRisk: Float!
  maxDailyDrawdown: Float!
  maxConsecutiveLoss: Int!
  notificationsOn: Boolean!
  dailyReportTime: String!
  timezone: String!
  circuitBreakerOn: Boolean!
  maxPositionSizeUSD: Float!
  maxTotalExposureUSD: Float!
  minPositionSizeUSD: Float!
  maxLeverageMultiple: Float!
  allowedExchanges: [String!]!
}

input CreateUserInput {
  telegramID: String
  telegramUsername: String
  email: String
  passwordHash: String
  firstName: String!
  lastName: String!
  languageCode: String!
  isActive: Boolean
  isPremium: Boolean
  limitProfileID: UUID
  settings: SettingsInput
}

input UpdateUserInput {
  telegramID: String
  telegramUsername: String
  email: String
  firstName: String
  lastName: String
  languageCode: String
  isPremium: Boolean
  limitProfileID: UUID
}

input SettingsInput {
  defaultAIProvider: String
  defaultAIModel: String
  riskLevel: String
  maxPositions: Int
  maxPortfolioRisk: Float
  maxDailyDrawdown: Float
  maxConsecutiveLoss: Int
  notificationsOn: Boolean
  dailyReportTime: String
  timezone: String
  circuitBreakerOn: Boolean
  maxPositionSizeUSD: Float
  maxTotalExposureUSD: Float
  minPositionSizeUSD: Float
  maxLeverageMultiple: Float
  allowedExchanges: [String!]
}

input UpdateUserSettingsInput {
  defaultAIProvider: String
  defaultAIModel: String
  riskLevel: String
  maxPositions: Int
  maxPortfolioRisk: Float
  maxDailyDrawdown: Float
  maxConsecutiveLoss: Int
  notificationsOn: Boolean
  dailyReportTime: String
  timezone: String
  circuitBreakerOn: Boolean
  maxPositionSizeUSD: Float
  maxTotalExposureUSD: Float
  minPositionSizeUSD: Float
  maxLeverageMultiple: Float
  allowedExchanges: [String!]
}

# Queries
extend type Query {
  # Get user by ID
  user(id: UUID!): User

  # Get user by telegram ID
  userByTelegramID(telegramID: String!): User

  # Get all users (admin only, legacy)
  users(limit: Int, offset: Int): [User!]!
    @deprecated(reason: "Use usersConnection instead")

  # Get all users (admin only, Relay Connection)
  usersConnection(
    first: Int
    after: String
    last: Int
    before: String
  ): UserConnection!
}

# Mutations
extend type Mutation {
  # Create new user (admin only)
  createUser(input: CreateUserInput!): User!

  # Update user (admin only)
  updateUser(id: UUID!, input: UpdateUserInput!): User!

  # Delete user (admin only, hard delete)
  deleteUser(id: UUID!): Boolean!

  # Batch delete users (admin only, hard delete)
  batchDeleteUsers(ids: [UUID!]!): Int!

  # Update user settings
  updateUserSettings(userID: UUID!, input: UpdateUserSettingsInput!): User!

  # Activate/deactivate user
  setUserActive(userID: UUID!, isActive: Boolean!): User!

  # Set premium status
  setUserPremium(userID: UUID!, isPremium: Boolean!): User!
}
